function setCookie(cname, cvalue, exdays) {
    let date = new Date();
    date.setTime(date.getTime() + (exdays * 24 * 60 * 60 * 1000));
    let expires = "expires=" + date.toUTCString() + "; path=/";
    document.cookie = cname + "=" + cvalue + "; " + expires;
}
function getCookie(cname) {
    let name = cname + "=";
    let ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
} function getUtcOffset() {
    return new Date().getTimezoneOffset();
}
function timeZoneCookie() {
    let timeOffset = getCookie("TimeZoneOffset");
    if (timeOffset == null || timeOffset == "") {
        setCookie("TimeZoneOffset", getUtcOffset(), 365);
        window.location.reload();
    }
}
let site = {
    utils: {
        language: function () {
            return {
                value: 0,
                langId: 1,
                url: site.utils.isRTL() ? 'ar' : 'en',
                locale: site.utils.isRTL() ? 'Arabic' : 'English',
                dir: site.utils.isRTL() ? 'rtl' : 'ltr'
            };
        },
        isMobile: function () {
            return document.body.clientWidth <= 992 ? true : false;
        },
        checkSize: function (_size) {
            return document.body.clientWidth <= _size ? true : false;
        },
        isRTL: function () {
            return document.getElementsByTagName("html")[0].getAttribute("lang") == "en" ? false : true;
        }
    },
    messages: function () {
        return site.utils.isRTL() ? site.messages_ar : site.messages_en;
    },
    messages_en: {
        required: "required",
        maxChars: "max {0} characters",
        charLimits: "must be {0} - {1} characters",
        invalidEmail: "invalid email",
        invalidMobile: "invalid mobile number",
        searchBoxPlaceholder: "search",
        noRecords: "No records",
        noSplChars: "Only letters are allowed",
        mirRobot: "Please verify that you are not a robot",
        iisMalformed: "The secret parameter is invalid or malformed",
        iirResponse: "The secret parameter is invalid or malformed",
        misSecret: "The secret parameter is missing"
    },
    messages_ar: {
        required: "مطلوب",
        maxChars: "ماكس {0} حرفا",
        charLimits: "يجب أن يكون {0} - {1} حرفا",
        invalidEmail: "بريد إلكتروني خاطئ",
        invalidMobile: "رقم الجوال غير صالح",
        searchBoxPlaceholder: "قم بالبحث عن طريق النشاط أو الترخيص أو خدمة إلكترونية",
        noRecords: "لا توجد نتائج",
        noSplChars: "الرجاء إدخال أحرف فقط",
        mirRobot: "Please verify that you are not a robot",
        iisMalformed: "The secret parameter is invalid or malformed",
        iirResponse: "The secret parameter is invalid or malformed",
        misSecret: "The secret parameter is missing"
    }
};

new WOW().init();
var myNav = document.querySelector("nav.navbar");
window.onscroll = function () {
    if (window.scrollY >= 20) {
        myNav.classList.add("fixed-top");
    }
    else {
        myNav.classList.remove("fixed-top");
    }
}

$(document).ready(function () {
    $('.mdb-select').material_select();
    
    /* ISD Dropdown list */
    if ($(".ddl-countryCode").length > 0) {
        $(".ddl-countryCode").intlTelInput({
            preferredCountries: ['sa'],
            customPlaceholder: function (selectedCountryPlaceholder, selectedCountryData) {
                return "+" + selectedCountryData.dialCode;
            },
            utilsScript: "/resources/js/utils.js"
        });
    }

     /* Send Email to your friend */
     $("#smf").on("click", function () {
        var _shareUrl = window.location.href;
        if ($("#smfUrl").val() != null)
            _shareUrl = $("#smfUrl").val();
        $.ajax({
            url: '/access/surface/ajaxform/SendEmailToFriend/',
            data: {
                from: $("#smfFrom").val(),
                to: $("#smfTo").val(),
                url: _shareUrl
            },
            success: function (data) {
                if (data == "Success") {
                    $("#smfUrl").val('');
                    $("#smfFrom").val('');
                    $("#smfTo").val('');
                    $("#modalShareWithFriend p.error").addClass("d-none");
                    $("#modalShareWithFriend p.success").removeClass("d-none");
                    //close the popup
                    setTimeout(function () {
                        $("#modalShareWithFriend .close").click();
                    }, 1000);
                }
                else {
                    $("#modalShareWithFriend p.error").removeClass("d-none");
                }
            },
            error: function (e) {
                console.log(e.responseText);
            }
        });
    });

    /* fancybox */
    $('[data-fancybox]').fancybox({
        protect: true,
        buttons: [//"zoom",//"share",//"slideShow",//"fullScreen",//"download",
            "thumbs", "close"]
    });
});

/* general form validation begins*/

function validateForm(ctrl) {
    let valid = true;
    if (ctrl.length == 0) {
        valid = false;
        return valid;
    }
    $.each($('.required', ctrl), function (i, e) {
        $(this).parent().find("label em").remove();
        let _label = $(this).parent().find("label").html();
        if ($(this).val() == null || $(this).val() == 0) {
            $(this).addClass('error');
            $(this).parent().find("label").html(_label + " <em><span>" + site.messages().required + "</span></em>");
            valid = false;
        }
        else if (!$(this).hasClass("md-textarea") && ($(this).val().length < 1 || $(this).val().length > 30)) {
            $(this).addClass('error');
            $(this).parent().find("label").html(_label + " <em><span>" + site.messages().charLimits.replace("{0}", 1).replace("{1}", 30) + "</span></em>");
            valid = false;
        }
        else {
            $(this).parent().find("label em").remove();
            $(this).removeClass('error');
        }
    });
    $.each($('.validate-name', ctrl), function (i, e) {
        let pattern = new RegExp(/^[-\sa-zA-Z,\u0600-\u06FF]+$/);
        let _label = $(this).parent().find("label").html();
        if (pattern.test($(this).val())) {
            $(this).removeClass('error');
            $(this).parent().find("label em").remove();
            $(this).parents("div." + ctrl.attr("id")).find(".validation-name").hide();
        }
        else {
            $(this).addClass('error');
            if ($(this).parent().find("label").find("em").length == 0) {
                $(this).parent().find("label").html(_label + " <em><span>" + site.messages().noSplChars + "</span></em>");
            }
            $(this).parents("div." + ctrl.attr("id")).find(".validation-name").show();
            valid = false;
        }
    });
    $.each($('.validate-email', ctrl), function (i, e) {
        let pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
        let _label = $(this).parent().find("label").html();
        if (pattern.test($(this).val())) {
            $(this).removeClass('error');
            $(this).parent().find("label em").remove();
            $(this).parents("div." + ctrl.attr("id")).find(".validation-email").hide();
        }
        else {
            $(this).addClass('error');
            if ($(this).parent().find("label").find("em").length == 0) {
                $(this).parent().find("label").html(_label + " <em><span>" + site.messages().invalidEmail + "</span></em>");
            }
            $(this).parents("div." + ctrl.attr("id")).find(".validation-email").show();
            valid = false;
        }
    });
    $.each($('.validate-mobile', ctrl), function (i, e) {
        let pattern = /^(?!0.)\d+$/;
        let _label = $(this).parent().find("label").html();
        if (pattern.test((parseInt($(this).val())))) {
            $(this).removeClass('error');
            $(this).parent().find("label em").remove();
            $(this).parents("div." + ctrl.attr("id")).find(".validation-mobile").hide();
        }
        else {
            $(this).addClass('error');
            if ($(this).parent().find("label").find("em").length == 0) {
                $(this).parent().find("label").html(_label + " <em><span>" + site.messages().invalidMobile + "</span></em>");
            }
            $(this).parents("div." + ctrl.attr("id")).find(".validation-mobile").show();
            valid = false;
        }
    });
    $.each($('.validate-url', ctrl), function (i, e) {
        if ($(this).val() != "") {
            let pattern = new RegExp('https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,}');

            if (pattern.test($(this).val())) {
                $(this).removeClass('error');
                $(".validation-url").hide();
            }
            else {
                $(this).addClass('error');
                $(".validation-url").show();
                valid = false;
            }
        }
        else {
            $(".validation-url").hide();
        }
    });
    return valid;
}
/* general form validation ends*/
/* get query string from url begins*/
function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
/* get query string from url ends*/

/* Event/News Filter begins */
function newsFilter(e) {
    window.location.href = "?catid=" + $(e.currentTarget).val();
}
function evtCategory(e) {
    window.location.href = "?catid=" + $(e.currentTarget).val();
}
function evtCity(e) {
    window.location.href = "?city=" + $(e.currentTarget).val();
}
function evtYear(e) {
    window.location.href = "?year=" + $(e.currentTarget).val();
}
function clearFilter() {
    window.location.href = window.location.pathname;
}
var city = getParameterByName("city");
if (city != null)
    document.getElementsByClassName("evtCity")[0].value = city;
var catId = getParameterByName("catid");
if (catId != null) {
    document.getElementsByClassName("evtCategory")[0].value = catId;
    document.getElementsByClassName("newsCategory")[0].value = catId;
}
var year = getParameterByName("year");
if (year != null)
    document.getElementsByClassName("evtYear")[0].value = year;
/* Event/News Filter ends */
